LEGO Power Functions RC Protocol
================================


Binary Representation
---------------------

+-------+---------------------------+---------------------+---------------+---------------+------+
|       | Nibble 1                  | Nibble 2            | Nibble 3      | Nibble 4      |      |
+-------+--------+--------+---------+---------+-----------+---------------+---------------+------+
| Start | Toggle | Escape | Channel | Address | Mode      | Data          | LRC           | Stop |
+-------+--------+--------+----+----+---------+---+---+---+---+---+---+---+---+---+---+---+------+
| start |      T |      E |  C |  C |       a | M | M | M | D | D | D | D | L | L | L | L | stop |
+-------+--------+--------+----+----+---------+---+---+---+---+---+---+---+---+---+---+---+------+


Field Descriptions
------------------

+---------+--------+---------+------------------------------------------------+
| Name    | Symbol | Values  | Description                                    |
+=========+========+=========+================================================+
| Start   | start  |         || Synchronization bit                           |
+---------+--------+---------+------------------------------------------------+
| Toggle  | T      || 0-1    || Toggles for each command                      |
+---------+--------+---------+------------------------------------------------+
| Escape  | E      || 0      || Use the 'Mode' selected below                 |
|         |        || 1      || Combo PWM mode                                |
+---------+--------+---------+------------------------------------------------+
| Channel | CC     || 0-3    || Channels, 1-4                                 |
+---------+--------+---------+------------------------------------------------+
| Address | a      || 0      || Default address space                         |
|         |        || 1      || Extra address space                           |
+---------+--------+---------+------------------------------------------------+
| Mode    | MMM    || 000    || Extended                                      |
|         |        || 001    || Combo Direct                                  |
|         |        || 01x    || Reserved                                      |
|         |        || 1xx    || Single Output                                 |
+---------+--------+---------+------------------------------------------------+
| Data    | DDDD   || 0-15   || Meaning depends on 'Mode'                     |
+---------+--------+---------+------------------------------------------------+
| LRC     | LLLL   || xxxx   || "Longitudinal Redundancy Check"               |
|         |        ||        || = 0xF xor Nibble 1 xor Nibble 2 xor Nibble 3  |
+---------+--------+---------+------------------------------------------------+
| Stop    | stop   |         || Synchronization bit (same as start)           |
+---------+--------+---------+------------------------------------------------+


Encoding
--------

+-------+--------------------+---------------------+
|       | Cycles             | Microseconds (us)   |
+-------+-------+----+-------+-------+-----+-------+
| Bit   | Total | IR | Pause | Total | IR  | Pause |
+=======+=======+====+=======+=======+=====+=======+
| Low   |    16 |  6 |    10 |   421 | 158 |   263 |
+-------+-------+----+-------+-------+-----+-------+
| High  |    27 |  6 |    21 |   711 | 158 |   553 |
+-------+-------+----+-------+-------+-----+-------+
| Start |    45 |  6 |    39 |  1184 | 158 |  1026 |
+-------+-------+----+-------+-------+-----+-------+


Decoding
--------

+-------+------------+-------------+-------------+
|       | Range (us) | Absolute    | Relative    |
+-------+-----+------+------+------+------+------+
| Bit   | Low | High | Low  | High | Low  | High |
+=======+=====+======+======+======+======+======+
| Low   | 316 |  526 | -105 | +105 | -25% | +25% |
+-------+-----+------+------+------+------+------+
| High  | 526 |  947 | -185 | +236 | -26% | +33% |
+-------+-----+------+------+------+------+------+
| Start | 947 | 1579 | -237 | +395 | -20% | +33% |
+-------+-----+------+------+------+------+------+


Mode Specific Information
-------------------------

.. toctree::
   :maxdepth: 1

   extended
   combo_direct
   single_output
   combo_pwm
